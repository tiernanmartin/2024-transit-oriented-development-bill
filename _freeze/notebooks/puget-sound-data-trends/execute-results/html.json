{
  "hash": "d07915b389d32c960805f28735850900",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Central Puget Sound Data Trends (2010 - 2023)\"\nauthor: \"Tiernan Martin\"\nformat:\n  html:\n    code-fold: true\n---\n\n::: {.cell .hidden}\n\n```{.r .cell-code .hidden}\n#| label: setup\n#| echo: false\n#| include: false\n\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.3     ✔ readr     2.1.4\n✔ forcats   1.0.0     ✔ stringr   1.5.0\n✔ ggplot2   3.4.4     ✔ tibble    3.2.1\n✔ lubridate 1.9.2     ✔ tidyr     1.3.0\n✔ purrr     1.0.2     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\n#| label: setup\n#| echo: false\n#| include: false\n\nlibrary(tidycensus)\nlibrary(glue)\nlibrary(scales)\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\n\nAttaching package: 'scales'\n\nThe following object is masked from 'package:purrr':\n\n    discard\n\nThe following object is masked from 'package:readr':\n\n    col_factor\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\n#| label: setup\n#| echo: false\n#| include: false\n\nlibrary(readxl)\nlibrary(janitor)\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\n\nAttaching package: 'janitor'\n\nThe following objects are masked from 'package:stats':\n\n    chisq.test, fisher.test\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\n#| label: setup\n#| echo: false\n#| include: false\n\nlibrary(here)\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nhere() starts at C:/Users/tiern/Documents/R/2024-transit-oriented-development-bill\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\n#| label: setup\n#| echo: false\n#| include: false\n\nlibrary(sf)\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nLinking to GEOS 3.11.2, GDAL 3.7.2, PROJ 9.3.0; sf_use_s2() is TRUE\n```\n\n\n:::\n:::\n\n\n\n## Data \n\nThis analysis uses data from Washington State's Office of Financial Management: [Historical estimates of April 1 population and housing for the state, counties, and cities](https://ofm.wa.gov/washington-data-research/population-demographics/population-estimates/historical-estimates-april-1-population-and-housing-state-counties-and-cities)\n\n### Change in Population\n\n\n::: {.cell .hidden}\n\n```{.r .cell-code .hidden}\n#| label: \"population-change-2010-2023\"\n#| include: false\n\npop_fp <- here(\"data/ofm_april1_postcensal_estimates_pop_1960-present.xlsx\")\n\npop_df <- read_excel(pop_fp, sheet = \"Population\", skip = 3) |> \n  clean_names()\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nNew names:\n• `` -> `...16`\n• `` -> `...18`\n• `` -> `...20`\n• `` -> `...22`\n• `` -> `...24`\n• `` -> `...26`\n• `` -> `...28`\n• `` -> `...30`\n• `` -> `...32`\n• `` -> `...34`\n• `` -> `...36`\n• `` -> `...38`\n• `` -> `...40`\n• `` -> `...42`\n• `` -> `...44`\n• `` -> `...46`\n• `` -> `...48`\n• `` -> `...50`\n• `` -> `...52`\n• `` -> `...54`\n• `` -> `...56`\n• `` -> `...58`\n• `` -> `...60`\n• `` -> `...62`\n• `` -> `...64`\n• `` -> `...66`\n• `` -> `...68`\n• `` -> `...70`\n• `` -> `...72`\n• `` -> `...74`\n• `` -> `...76`\n• `` -> `...78`\n• `` -> `...80`\n• `` -> `...82`\n• `` -> `...84`\n• `` -> `...86`\n• `` -> `...88`\n• `` -> `...90`\n• `` -> `...92`\n• `` -> `...94`\n• `` -> `...96`\n• `` -> `...98`\n• `` -> `...100`\n• `` -> `...102`\n• `` -> `...104`\n• `` -> `...106`\n• `` -> `...108`\n• `` -> `...110`\n• `` -> `...112`\n• `` -> `...114`\n• `` -> `...116`\n• `` -> `...118`\n• `` -> `...120`\n• `` -> `...122`\n• `` -> `...124`\n• `` -> `...126`\n• `` -> `...128`\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\n#| label: \"population-change-2010-2023\"\n#| include: false\n\nps_counties <- c(\"King\",\n                 \"Snohomish\",\n                 \"Kitsap\",\n                 \"Pierce\")\n\npop_growth <- pop_df |> \n  filter(filter %in% \"1\") |>  \n  pivot_longer(cols = x_1960_census_count_of_total_population:last_col()) |> \n  mutate(value = as.numeric(value),\n         pugetsound = case_when(\n    county %in%  ps_counties ~ TRUE,\n    TRUE ~ FALSE\n  )) |> \n  filter(str_detect(name, \"2010|2023\")) |> \n  filter(str_detect(name,\"postcensal\")) |> \n  mutate(name = str_c(\"pop_\", str_extract(name,\"\\\\d{4}\"))) |> \n  pivot_wider(names_from = name,\n              values_from = value) |> \n  group_by(pugetsound) |> \n  summarise(pop_2010 = max(pop_2010),\n            pop_2023 = max(pop_2023),\n            pop_change = sum(pop_2023) - sum(pop_2010)) |> \n  ungroup() |> \n  mutate(pop_change_pct = round(digits = 2, pop_change / pop_2010))\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nWarning: There was 1 warning in `mutate()`.\nℹ In argument: `value = as.numeric(value)`.\nCaused by warning:\n! NAs introduced by coercion\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\n#| label: \"population-change-2010-2023\"\n#| include: false\n\npop_growth\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 2 × 5\n  pugetsound pop_2010 pop_2023 pop_change pop_change_pct\n  <lgl>         <dbl>    <dbl>      <dbl>          <dbl>\n1 FALSE        470300   554600      84300           0.18\n2 TRUE        1933400  2347800     414400           0.21\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\n#| label: \"pop-cities-2022\"\n\nps_data_cities <- get_acs(\n  geometry = TRUE, \n  geography = \"place\", \n  variables = c(population = \"B01003_001\",\n                housing_units = \"B25001_001\"), \n  state = \"WA\", \n  year = 2022, \n  survey = \"acs5\" \n) |> clean_names()\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nGetting data from the 2018-2022 5-year ACS\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nDownloading feature geometry from the Census website.  To cache shapefiles for use in future sessions, set `options(tigris_use_cache = TRUE)`.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n  |                                                                            \n  |                                                                      |   0%\n  |                                                                            \n  |===                                                                   |   4%\n  |                                                                            \n  |=====                                                                 |   7%\n  |                                                                            \n  |======                                                                |   9%\n  |                                                                            \n  |=========                                                             |  12%\n  |                                                                            \n  |============                                                          |  16%\n  |                                                                            \n  |=================                                                     |  24%\n  |                                                                            \n  |====================                                                  |  28%\n  |                                                                            \n  |======================                                                |  32%\n  |                                                                            \n  |=========================                                             |  35%\n  |                                                                            \n  |==========================                                            |  37%\n  |                                                                            \n  |=============================                                         |  42%\n  |                                                                            \n  |================================                                      |  45%\n  |                                                                            \n  |===================================                                   |  50%\n  |                                                                            \n  |======================================                                |  54%\n  |                                                                            \n  |========================================                              |  58%\n  |                                                                            \n  |==========================================                            |  59%\n  |                                                                            \n  |==================================================                    |  71%\n  |                                                                            \n  |====================================================                  |  75%\n  |                                                                            \n  |=======================================================               |  78%\n  |                                                                            \n  |=========================================================             |  82%\n  |                                                                            \n  |==========================================================            |  84%\n  |                                                                            \n  |=============================================================         |  87%\n  |                                                                            \n  |================================================================      |  91%\n  |                                                                            \n  |======================================================================| 100%\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\n#| label: \"pop-cities-2022\"\n\nps_cities_sf <- ps_data_cities |> \n  filter(variable == \"population\") |> \n  select(geoid)\n\nps_data_cities_ready <- ps_data_cities |> \n  st_drop_geometry() |> \n  select(geoid, name, variable, estimate) |> \n  filter(str_detect(name,\"city\")) |> \n  mutate(name = str_remove(name,\" city, Washington\")) |> \n  pivot_wider(names_from = variable, values_from = estimate) |> \n  left_join(ps_cities_sf) |> \n  st_sf()\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nJoining with `by = join_by(geoid)`\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\n#| label: \"pop-cities-2022\"\n\nst_write(ps_data_cities_ready,\n         here(\"data_outputs/2024-tod-bill.gpkg\"),\n         layer = \"ps-cities-pop-hu\",delete_layer = TRUE)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nDeleting layer `ps-cities-pop-hu' using driver `GPKG'\nWriting layer `ps-cities-pop-hu' to data source \n  `C:/Users/tiern/Documents/R/2024-transit-oriented-development-bill/data_outputs/2024-tod-bill.gpkg' using driver `GPKG'\nWriting 212 features with 4 fields and geometry type Multi Polygon.\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\n#| label: pop-change-r-objects\n#| output: false\n\npugetsound_pop_growth_2010_2023 <- pop_growth |> filter(pugetsound) |> pluck(\"pop_change\")\n\nsaveRDS(pugetsound_pop_growth_2010_2023,\n        here(\"data_outputs/pugetsound_pop_growth_2010_2023.rds\"))\n\noutside_pop_growth_2010_2023 <- pop_growth |> filter(!pugetsound) |> pluck(\"pop_change\")\n\nsaveRDS(outside_pop_growth_2010_2023,\n        here(\"data_outputs/outside_pop_growth_2010_2023.rds\"))\n\npop_change_pct <- pop_growth |> filter(pugetsound) |> pluck(\"pop_change_pct\")\n\npop_change_text <- glue(\"{comma(pugetsound_pop_growth_2010_2023)} people (a {percent(pop_change_pct)} increase)\")\n```\n:::\n\n\n\n### Change in Housing Units\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\n#| label: \"housing-change-2010-2023\"\n#| output: true\n\nuh_fp <- here(\"data/ofm_april1_postcensal_estimates_housing_1980_1990-present.xlsx\")\n\nhu_df <- read_excel(uh_fp, sheet = \"Housing Units\", skip = 3) |>  \n  clean_names()\n\nhu_growth_2010_2023 <- hu_df |> \n  filter(filter %in% \"1\") |> \n  pivot_longer(cols = x1980_census_count_of_total_housing_units:last_col()) |> \n  mutate(value = as.numeric(value),\n         pugetsound = case_when(\n           county %in% c(\"King\",\n                         \"Snohomish\",\n                         \"Kitsap\",\n                         \"Pierce\") ~ TRUE,\n           TRUE ~ FALSE\n         )) |> \n  # filter(str_detect(name,\"postcensal\")) |> \n  filter(str_detect(name,\"total\")) |> \n  filter(str_detect(name, \"2010|2023\")) |>  \n  mutate(name = str_c(\"hu_\", str_extract(name,\"\\\\d{4}\"))) |> \n  pivot_wider(names_from = name,\n              values_from = value) |> \n  group_by(pugetsound) |> \n  summarise(hu = sum(hu_2023) - sum(hu_2010))\n\nhu_growth_2010_2023\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 2 × 2\n  pugetsound     hu\n  <lgl>       <dbl>\n1 FALSE      179786\n2 TRUE       276177\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\n#| label: \"hu-change-r-objects\"\n#| output: false\n\npugetsound_hu_growth_2010_2023 <- hu_growth_2010_2023 |> filter(pugetsound) |> pluck(\"hu\")\n\nsaveRDS(pugetsound_hu_growth_2010_2023,\n        here(\"data_outputs/pugetsound_hu_growth_2010_2023.rds\"))\n\n\noutside_hu_pop_growth_2010_2023 <- hu_growth_2010_2023 |> filter(!pugetsound) |> pluck(\"hu\")\n\nsaveRDS(outside_hu_pop_growth_2010_2023,\n        here(\"data_outputs/outside_hu_growth_2010_2023.rds\"))\n```\n:::\n",
    "supporting": [
      "puget-sound-data-trends_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}